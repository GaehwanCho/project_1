---
title: cmake 사용
categories: sw
tags: [cmake, flag, CMakeList]
toc: ture
toc_sticky: true
last_modified_at: 2020-11-13
---

# flags

cpp cmake의 flag 설정은

```cmake
SET(CMAKE_CXX_FLAGS ${CMAKE_CXX_FLAGS} "-O2")
```

와 같이 설정한다.

## optimization flag (-O)

-O 옵션은 최적화의 전체 수준을 제어합니다.  
이 값을 늘려 바꾸면 최적화 설정을 통해 특히 최적화 레벨을 올리는 만큼 코드 컴파일 과정의 시간을 더 걸리게 하거나, 메모리를 더 많이 소비합니다.

7가지의 -O 레벨 설정 `-O0, -O1, -O2, -O3, -Os, -Og, -Ofast`가 있습니다. `/etc/portage/make.conf` 파일에서 이들 중 하나만을 사용해야 합니다.

각각의 최적화 레벨을 살펴보도록 하겠습니다:

- O0: 이 레벨(글자"O" 다음에 숫자 영이 따라옴)은 최적화를 완전히 끄고, CFLAGS 또는 CXXFLAGS에 -O 레벨을 기본으로 지정하지 않았을 경우에 기본값이 됩니다. 컴파일 시간을 줄이고 디버그 정보를 개선할 수 있지만, 어떤 프로그램은 최적화를 활성화 하지 않으면 제대로 동작하지 않는 수가 있습니다. 이 옵션은 디버깅 목적이 아니라면 사용하지 않는 것이 좋습니다.
- O1: 이 레벨은 매우 기본적인 최적화를 수행합니다. 컴파일러는 더 많은 컴파일 시간을 소비하지 않고도 빠르고 작은 코드를 만들어냅니다. 기본적일 수는 있지만 항상 컴파일 작업이 완료됩니다.
- O2: -O1에서 한 단계 상승합니다. 시스템에서 특별하게 필요한 경우가 아닌 한 권장하는 최적화 레벨입니다. -O2 플래그는 -O1 플래그로 활성화 한 플래그보다 더 많은 플래그를 활성화 합니다. -O2 플래그로, 컴파일러에서는 바이너리 크기와의 절충 없이 무조건 코드 성능을 끌어올리여 하며, 컴파일 시간을 너무 많이 소비하지 않습니다.
- O3: 가능한 가장 높은 최적화 레벨입니다. 컴파일 시간과 메모리 사용에 있어 그 이상의 최적화를 활성화합니다. -O3으로 컴파일 할 때는 성능을 개선한다는 보장이 없으며, 실제로 대부분의 경우, 바이너리가 커지고 메모리 사용량이 증가하여 시스템을 느리개 할 수 있습니다. -O3는 또한 몇가지 꾸러미를 깨뜨리는 걸로 알려져 있습니다. -O3 플래그 사용을 권장하지 않습니다.
- Os: 코드 크기를 최적화 합니다. 만든 코드의 크기가 늘어나지 않게 하는 모든 -O2 옵션을 활성화 합니다. 매우 제한된 디스크 저장소 공간을 가지고 있거나 CPU의 캐시 크기가 작을 경우 유용합니다.
- Og: GCC4.8에 새로운 일반 최적화 레벨 -Og를 도입했습니다. 빠른 컴파일을 필요로 하며 실행시간 성능의 타당한 수준을 제공하면서 우수한 디버깅 경험을 할 수 있게 바로 잡았습니다. 개발에 있어 전체적인 경험은 기본 최적화 레벨 -O0보단 낫습니다. 참고로 -Og는 -g를 의미하지 않으며, 디버깅에 혼란을 주는 최적화 기능을 끌 뿐입니다.
- Ofast: GCC 4.7에서 새로 도입했으며, -O3, -ffast-math, -fno-protect-parens, and -fstack-arrays로 이루어져 있습니다. 이 옵션은 엄격한 표준 준수를 깨며, 사용을 권장하지 않습니다.
- 이전에 말한 바와 같이, -O2가 추천하는 최적화 레벨입니다. -O2를 사용하지 않아 패키지 컴파일에 실패했다면 이 옵션으로 다시 빌드해보십시오. 대체 옵션으로 -O1또는 -O0 -g2 - ggdb 같은 더 낮은 최적화 레벨의 플래그로 CFLAGS와 CXXFLAGS를 설정해보십시오(오류 보고 및 존재하는 문제 확인용).

reference) <br>
[Gentoo's wiki](https://wiki.gentoo.org/wiki/GCC_optimization/ko#.EC.98.A4.ED.95.B4)
